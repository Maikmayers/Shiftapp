8<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schichtkalender Portable</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- Babel für JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .no-select { user-select: none; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

<div id="root"></div>

<script type="text/babel">
    // =====================================================================================
    // HIER EINFÜGEN:
    // Wenn Sie Ihre Daten (Urlaub, Passwort, Schicht) dauerhaft speichern wollen,
    // kopieren Sie den generierten Code aus den Einstellungen zwischen die Anführungszeichen.
    // =====================================================================================
    
    const MEINE_GESPEICHERTEN_DATEN = "eyJoYXNoIjoiNzVmNjkyOTRiY2NlNWI3M2QwYTVjMDg0ZjRiYjdmNzY2MWQzZjAxYmVlNjE5MzM3YzAwYjMxMTUyMDNlYjMwNiIsImRhdGEiOnsic2FsdCI6IjlZcHVUc3hUU0lQWGFDZGdFMW8xRVE9PSIsIml2IjoiNk9makFvUlFPMm1tRzE1ciIsImRhdGEiOiJFdDZDNUx3MjZPSzJ2TldTOG5KdmdKNG9CUlhUU2RtRGdVWWNFalJidFdSeC9WRTN4d0xvbnBTY2IxeE4wd1V6T2Z1aFBQVmlFMGp0QU5yTGVmcWFtTkR0K0tadlRiaFU1TGtVM2dpZW4zWmJ3dHBCdVlkMitFLzhyZz09In19";

    // =====================================================================================


    const { useState, useEffect, useRef } = React;

    // --- ICONS ---
    const IconSettings = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>;
    const IconLock = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>;
    const IconCalendar = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>;
    const IconSave = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>;
    const IconChevronLeft = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="15 18 9 12 15 6"/></svg>;
    const IconChevronRight = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="9 18 15 12 9 6"/></svg>;
    const IconTrash = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>;
    const IconLogOut = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>;
    const IconCopy = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>;

    // --- DATEN ---
    const PUBLIC_HOLIDAYS_SACHSEN = {
      '2025-01-01': 'Neujahr', '2025-04-18': 'Karfreitag', '2025-04-21': 'Ostermontag', '2025-05-01': 'Tag der Arbeit',
      '2025-05-29': 'Christi Himmelfahrt', '2025-06-09': 'Pfingstmontag', '2025-10-03': 'Tag der dt. Einheit',
      '2025-10-31': 'Reformationstag', '2025-11-19': 'Buß- und Bettag', '2025-12-25': '1. Weihnachtstag', '2025-12-26': '2. Weihnachtstag',
      '2026-01-01': 'Neujahr', '2026-04-03': 'Karfreitag', '2026-04-06': 'Ostermontag', '2026-05-01': 'Tag der Arbeit',
      '2026-05-14': 'Christi Himmelfahrt', '2026-05-25': 'Pfingstmontag', '2026-10-03': 'Tag der dt. Einheit',
      '2026-10-31': 'Reformationstag', '2026-11-18': 'Buß- und Bettag', '2026-12-25': '1. Weihnachtstag', '2026-12-26': '2. Weihnachtstag',
    };
    const SCHOOL_HOLIDAYS_THURINGEN = [
      { start: '2025-02-03', end: '2025-02-08', name: 'Winterferien' }, { start: '2025-04-07', end: '2025-04-19', name: 'Osterferien' },
      { start: '2025-05-30', end: '2025-05-30', name: 'Ferientag' }, { start: '2025-06-28', end: '2025-08-08', name: 'Sommerferien' },
      { start: '2025-10-06', end: '2025-10-18', name: 'Herbstferien' }, { start: '2025-12-22', end: '2026-01-03', name: 'Weihnachtsferien' },
      { start: '2026-02-16', end: '2026-02-21', name: 'Winterferien' }, { start: '2026-04-07', end: '2026-04-17', name: 'Osterferien' },
      { start: '2026-05-15', end: '2026-05-15', name: 'Ferientag' }, { start: '2026-07-04', end: '2026-08-14', name: 'Sommerferien' },
      { start: '2026-10-12', end: '2026-10-24', name: 'Herbstferien' }, { start: '2026-12-23', end: '2027-01-02', name: 'Weihnachtsferien' },
    ];
    const SHIFT_CYCLE = ['Früh', 'Nacht', 'Mittel']; 
    const SHIFT_COLORS = { 'Früh': 'bg-yellow-100 border-yellow-300 text-yellow-800', 'Mittel': 'bg-orange-100 border-orange-300 text-orange-800', 'Nacht': 'bg-blue-100 border-blue-300 text-blue-800', 'Frei': 'bg-gray-50 text-gray-400' };

    // --- KRYPTO ---
    async function generateKey(password, salt) {
      const enc = new TextEncoder();
      const keyMaterial = await window.crypto.subtle.importKey("raw", enc.encode(password), { name: "PBKDF2" }, false, ["deriveKey"]);
      return window.crypto.subtle.deriveKey({ name: "PBKDF2", salt: salt, iterations: 100000, hash: "SHA-256" }, keyMaterial, { name: "AES-GCM", length: 256 }, false, ["encrypt", "decrypt"]);
    }
    async function encryptData(data, password) {
      const salt = window.crypto.getRandomValues(new Uint8Array(16));
      const iv = window.crypto.getRandomValues(new Uint8Array(12));
      const key = await generateKey(password, salt);
      const enc = new TextEncoder();
      const encrypted = await window.crypto.subtle.encrypt({ name: "AES-GCM", iv: iv }, key, enc.encode(JSON.stringify(data)));
      const b2a = (buf) => btoa(String.fromCharCode(...new Uint8Array(buf)));
      return { salt: b2a(salt), iv: b2a(iv), data: b2a(encrypted) };
    }
    async function decryptData(encryptedObj, password) {
      try {
        const a2b = (str) => Uint8Array.from(atob(str), c => c.charCodeAt(0));
        const key = await generateKey(password, a2b(encryptedObj.salt));
        const decrypted = await window.crypto.subtle.decrypt({ name: "AES-GCM", iv: a2b(encryptedObj.iv) }, key, a2b(encryptedObj.data));
        return JSON.parse(new TextDecoder().decode(decrypted));
      } catch (e) { throw new Error("Falsches Passwort."); }
    }
    async function hashPassword(password) {
      const buffer = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(password));
      return Array.from(new Uint8Array(buffer)).map(b => b.toString(16).padStart(2, '0')).join('');
    }

    // --- APP ---
    function App() {
      const [isAuthenticated, setIsAuthenticated] = useState(false);
      const [isFirstRun, setIsFirstRun] = useState(true);
      const [passwordInput, setPasswordInput] = useState('');
      const [currentPassword, setCurrentPassword] = useState('');
      const [errorMsg, setErrorMsg] = useState('');
      const [loading, setLoading] = useState(true);
      
      const [events, setEvents] = useState({});
      const [settings, setSettings] = useState({ startWeekDate: new Date().toISOString().split('T')[0], startShiftIndex: 0 });
      const [exportCode, setExportCode] = useState('');

      const [viewDate, setViewDate] = useState(new Date());
      const [selectedDate, setSelectedDate] = useState(null);
      const [showSettings, setShowSettings] = useState(false);

      // --- INITIAL LOAD ---
      useEffect(() => {
        const init = async () => {
          // Check hardcoded data first
          if (MEINE_GESPEICHERTEN_DATEN && MEINE_GESPEICHERTEN_DATEN.length > 10) {
             setIsFirstRun(false); // Data exists, so it's not first run
          } else {
             // Fallback to local storage for convenience if empty
             const localHash = localStorage.getItem('sachsen_shift_auth');
             if (localHash) setIsFirstRun(false);
          }
          setLoading(false);
        };
        init();
      }, []);

      // --- LOGIN / SETUP ---
      const handleLogin = async (e) => {
        e.preventDefault();
        setErrorMsg('');
        setLoading(true);

        try {
          // 1. Determine Source (Hardcode vs LocalStorage vs New)
          let sourceData = null;
          let storedHash = null;

          if (MEINE_GESPEICHERTEN_DATEN && MEINE_GESPEICHERTEN_DATEN.length > 10) {
             try {
                // The hardcoded string is a JSON of { hash: '...', data: {encryptedObject} }
                const parsed = JSON.parse(atob(MEINE_GESPEICHERTEN_DATEN));
                sourceData = parsed;
                storedHash = parsed.hash;
             } catch(e) { console.error("Hardcoded data corrupt"); }
          }
          
          if (!sourceData) {
             // Fallback LocalStorage
             const localHash = localStorage.getItem('sachsen_shift_auth');
             if (localHash) {
                storedHash = localHash;
                const localData = localStorage.getItem('sachsen_shift_data');
                if (localData) sourceData = { data: JSON.parse(localData) };
             }
          }

          if (isFirstRun && !storedHash) {
            // --- NEW SETUP ---
            const hash = await hashPassword(passwordInput);
            setCurrentPassword(passwordInput);
            setIsAuthenticated(true);
            setIsFirstRun(false);
            // Save initial local state
            const initEnc = await encryptData({ events: {}, settings }, passwordInput);
            localStorage.setItem('sachsen_shift_auth', hash);
            localStorage.setItem('sachsen_shift_data', JSON.stringify(initEnc));
          } else {
            // --- LOGIN ATTEMPT ---
            const inputHash = await hashPassword(passwordInput);
            if (storedHash === inputHash) {
               if (sourceData && sourceData.data) {
                  try {
                     const dec = await decryptData(sourceData.data, passwordInput);
                     setEvents(dec.events || {});
                     setSettings(dec.settings || settings);
                  } catch (e) {
                     setErrorMsg("Daten konnten nicht entschlüsselt werden.");
                     setLoading(false);
                     return;
                  }
               }
               setCurrentPassword(passwordInput);
               setIsAuthenticated(true);
            } else {
               setErrorMsg("Falsches Passwort.");
            }
          }
        } catch (err) {
          setErrorMsg("Fehler beim Laden.");
        }
        setLoading(false);
      };

      // --- AUTO LOCAL SAVE (Komfort, falls man nicht sofort exportiert) ---
      useEffect(() => {
        if (!isAuthenticated || !currentPassword) return;
        const autoSave = async () => {
           const enc = await encryptData({ events, settings }, currentPassword);
           const hash = await hashPassword(currentPassword);
           localStorage.setItem('sachsen_shift_auth', hash);
           localStorage.setItem('sachsen_shift_data', JSON.stringify(enc));
        };
        const t = setTimeout(autoSave, 1000);
        return () => clearTimeout(t);
      }, [events, settings, isAuthenticated, currentPassword]);

      // --- EXPORT GENERATOR ---
      const generateExportCode = async () => {
         if (!currentPassword) return;
         const hash = await hashPassword(currentPassword);
         const enc = await encryptData({ events, settings }, currentPassword);
         const exportObj = { hash: hash, data: enc };
         // Encode to Base64 to make it a simple single-line string
         const exportString = btoa(JSON.stringify(exportObj));
         setExportCode(exportString);
      };

      // --- CALENDAR LOGIC ---
      const getWeekNumber = (d) => {
        d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
        d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
        const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
        return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
      };

      const getShiftForDate = (dateStr) => {
        const date = new Date(dateStr);
        const day = date.getDay();
        if (day === 0 || day === 6) return 'Frei';
        
        const getMonday = (d) => {
            const dt = new Date(d);
            const day = dt.getDay();
            const diff = dt.getDate() - day + (day === 0 ? -6 : 1);
            return new Date(dt.setDate(diff));
        }
        const startMonday = getMonday(new Date(settings.startWeekDate));
        const currentMonday = getMonday(date);
        const diffWeeks = Math.round((currentMonday - startMonday) / (1000 * 60 * 60 * 24 * 7));
        let shiftIndex = (settings.startShiftIndex + diffWeeks) % 3;
        if (shiftIndex < 0) shiftIndex += 3;
        return SHIFT_CYCLE[shiftIndex];
      };

      // --- RENDER HELPERS ---
      const handleDateClick = (day) => day && setSelectedDate(day);
      const saveEvent = (type, title) => {
         const newE = { ...events };
         (!type && !title) ? delete newE[selectedDate.date] : newE[selectedDate.date] = { type, title };
         setEvents(newE); setSelectedDate(null);
      };
      
      const days = [];
      const year = viewDate.getFullYear();
      const month = viewDate.getMonth();
      const firstDay = (new Date(year, month, 1).getDay() || 7) - 1;
      const totalDays = new Date(year, month + 1, 0).getDate();
      for(let i=0; i<firstDay; i++) days.push(null);
      for(let i=1; i<=totalDays; i++) {
         const d = `${year}-${String(month+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
         days.push({ day: i, date: d, shift: getShiftForDate(d), event: events[d], 
                     isHoliday: PUBLIC_HOLIDAYS_SACHSEN[d], 
                     schoolHoliday: SCHOOL_HOLIDAYS_THURINGEN.find(h => d >= h.start && d <= h.end) });
      }

      if (loading) return <div className="flex h-screen items-center justify-center">Laden...</div>;
      
      // --- LOGIN SCREEN ---
      if (!isAuthenticated) return (
         <div className="flex min-h-screen items-center justify-center bg-slate-100 p-4">
            <div className="w-full max-w-md rounded-xl bg-white p-8 shadow-xl">
               <div className="mb-6 flex justify-center"><div className="rounded-full bg-blue-100 p-4"><IconLock className="h-8 w-8 text-blue-600"/></div></div>
               <h2 className="text-center text-2xl font-bold mb-6">{isFirstRun ? "Setup" : "Login"}</h2>
               <form onSubmit={handleLogin} className="space-y-4">
                  <input type="password" value={passwordInput} onChange={e=>setPasswordInput(e.target.value)} placeholder="Passwort" className="w-full border p-3 rounded" autoFocus />
                  {errorMsg && <p className="text-red-500 text-sm">{errorMsg}</p>}
                  <button disabled={!passwordInput} className="w-full bg-blue-600 text-white py-3 rounded hover:bg-blue-700 disabled:opacity-50">Starten</button>
               </form>
               <div className="mt-4 text-xs text-center text-slate-400">
                  {MEINE_GESPEICHERTEN_DATEN && MEINE_GESPEICHERTEN_DATEN.length > 10 ? "Tragbare Datei erkannt." : "Keine gespeicherten Daten im Code gefunden."}
               </div>
            </div>
         </div>
      );

      // --- MAIN SCREEN ---
      return (
         <div className="min-h-screen pb-10">
            <header className="sticky top-0 z-10 bg-white shadow-sm px-4 py-3 flex justify-between items-center max-w-4xl mx-auto">
               <div className="flex items-center gap-2"><IconCalendar className="text-blue-600"/> <h1 className="font-bold">Schichtplan</h1></div>
               <div className="flex gap-2">
                  <button onClick={()=>{setExportCode(''); setShowSettings(true)}} className="p-2 hover:bg-slate-100 rounded-full"><IconSettings/></button>
                  <button onClick={()=>{setIsAuthenticated(false); setPasswordInput('');}} className="p-2 hover:bg-slate-100 rounded-full"><IconLogOut/></button>
               </div>
            </header>

            <main className="max-w-4xl mx-auto mt-6 px-4">
               <div className="flex justify-between items-center bg-white p-4 rounded-xl shadow-sm mb-6">
                  <button onClick={()=>setViewDate(new Date(year, month-1, 1))}><IconChevronLeft/></button>
                  <h2 className="font-bold text-xl">{viewDate.toLocaleString('de-DE', {month:'long', year:'numeric'})}</h2>
                  <button onClick={()=>setViewDate(new Date(year, month+1, 1))}><IconChevronRight/></button>
               </div>

               <div className="bg-white rounded-xl shadow-sm ring-1 ring-slate-200 overflow-hidden">
                  <div className="grid grid-cols-7 bg-slate-50 border-b p-2 text-center text-xs font-bold text-slate-500">
                     {['Mo','Di','Mi','Do','Fr','Sa','So'].map(d=><div key={d}>{d}</div>)}
                  </div>
                  <div className="grid grid-cols-7">
                     {days.map((d,i) => {
                        if(!d) return <div key={i} className="h-24 border-b border-r bg-slate-50/50"/>;
                        let bg = d.event?.type === 'urlaub' ? 'bg-purple-100' : (d.isHoliday ? 'bg-red-50' : (d.shift==='Frei'?'bg-white':SHIFT_COLORS[d.shift].split(' ')[0]));
                        return (
                           <div key={d.date} onClick={()=>handleDateClick(d)} className={`h-24 sm:h-32 border-b border-r p-1 cursor-pointer hover:opacity-80 transition ${bg}`}>
                              <div className="flex justify-between">
                                 <span className={`w-6 h-6 flex items-center justify-center rounded-full text-sm ${d.date===new Date().toISOString().split('T')[0]?'bg-blue-600 text-white':''}`}>{d.day}</span>
                                 {d.shift!=='Frei' && !d.isHoliday && !d.event && <span className={`text-[10px] font-bold px-1 rounded ${SHIFT_COLORS[d.shift].replace('bg-','text-').replace('border-','')}`}>{d.shift[0]}</span>}
                              </div>
                              <div className="mt-1 space-y-1">
                                 {d.isHoliday && <div className="text-[9px] bg-red-100 text-red-700 px-1 rounded truncate">{d.isHoliday}</div>}
                                 {d.schoolHoliday && !d.isHoliday && <div className="text-[9px] bg-amber-100 text-amber-700 px-1 rounded truncate">FH</div>}
                                 {d.event && <div className={`text-[9px] px-1 rounded truncate ${d.event.type==='urlaub'?'bg-purple-200 text-purple-800':'bg-emerald-100 text-emerald-800'}`}>{d.event.title||'Termin'}</div>}
                              </div>
                           </div>
                        );
                     })}
                  </div>
               </div>
            </main>

            {/* MODALS */}
            {selectedDate && (
               <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                  <div className="bg-white p-6 rounded-xl w-full max-w-sm">
                     <h3 className="font-bold mb-4">{new Date(selectedDate.date).toLocaleDateString('de-DE')} ({selectedDate.shift})</h3>
                     <div className="space-y-3">
                        <button onClick={()=>saveEvent('urlaub','Urlaub')} className="w-full py-3 bg-purple-100 text-purple-700 rounded font-medium">Urlaub</button>
                        <div className="flex gap-2">
                           <input id="tInput" type="text" placeholder="Termin..." className="flex-1 border p-2 rounded" defaultValue={selectedDate.event?.type==='termin'?selectedDate.event.title:''} />
                           <button onClick={()=>saveEvent('termin', document.getElementById('tInput').value)} className="bg-blue-600 text-white p-2 rounded"><IconSave/></button>
                        </div>
                        {selectedDate.event && <button onClick={()=>saveEvent(null,null)} className="w-full py-2 border border-red-200 text-red-600 rounded flex justify-center items-center gap-2"><IconTrash className="w-4 h-4"/> Löschen</button>}
                     </div>
                     <button onClick={()=>setSelectedDate(null)} className="mt-4 w-full py-2 bg-slate-100 rounded">Schließen</button>
                  </div>
               </div>
            )}

            {showSettings && (
               <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                  <div className="bg-white p-6 rounded-xl w-full max-w-md max-h-[90vh] overflow-y-auto">
                     <h2 className="font-bold text-lg mb-4 flex items-center gap-2"><IconSettings/> Einstellungen</h2>
                     
                     <div className="mb-6 space-y-4">
                        <h3 className="font-semibold text-sm text-slate-500 uppercase">Schicht-Konfiguration</h3>
                        <div>
                           <label className="text-sm block mb-1">Startwoche (Montag)</label>
                           <input type="date" defaultValue={settings.startWeekDate} id="sDate" className="w-full border p-2 rounded"/>
                        </div>
                        <div>
                           <label className="text-sm block mb-1">Schicht in Startwoche</label>
                           <select defaultValue={settings.startShiftIndex} id="sShift" className="w-full border p-2 rounded">
                              {SHIFT_CYCLE.map((s,i)=><option key={s} value={i}>{s}</option>)}
                           </select>
                        </div>
                        <button onClick={()=>{
                           const d=document.getElementById('sDate').value; const s=document.getElementById('sShift').value;
                           setSettings({...settings, startWeekDate:d, startShiftIndex:parseInt(s)}); setShowSettings(false);
                        }} className="w-full bg-blue-600 text-white py-2 rounded">Übernehmen</button>
                     </div>

                     <div className="border-t pt-4">
                        <h3 className="font-semibold text-sm text-slate-500 uppercase mb-2">Datei-Speicherung (Portabel)</h3>
                        <p className="text-xs text-slate-500 mb-3">
                           Da Browser Dateien nicht direkt ändern können, müssen Sie den Code unten kopieren und manuell in diese HTML-Datei einfügen (Zeile "MEINE_GESPEICHERTEN_DATEN").
                        </p>
                        
                        {!exportCode ? (
                           <button onClick={generateExportCode} className="w-full bg-slate-800 text-white py-2 rounded flex items-center justify-center gap-2">
                              <IconCopy className="w-4 h-4"/> Code generieren
                           </button>
                        ) : (
                           <div className="space-y-2 animate-in fade-in slide-in-from-bottom-2">
                              <textarea readOnly value={exportCode} className="w-full h-32 text-[10px] font-mono border p-2 rounded bg-slate-50 break-all" onClick={e=>e.target.select()}/>
                              <div className="text-xs text-green-600 font-bold text-center">Code kopiert! In HTML-Datei einfügen.</div>
                           </div>
                        )}
                     </div>

                     <button onClick={()=>setShowSettings(false)} className="mt-6 w-full py-2 bg-slate-100 rounded">Schließen</button>
                  </div>
               </div>
            )}
         </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>

</body>
</html>

